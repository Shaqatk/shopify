{% comment %}
  A24 Purchase Bar - Phase 4
  
  Sticky purchase bar with:
  - Quantity selector (1-9 via a24-selector)
  - Add to Cart / Sold Out / In Cart button
  
  Default state: light background, outlined button.
  Pinned state (.state-pinned): transparent bar, dark button, quantity hidden on tablet.
  JS: assets/a24-product.js (Intersection Observer, quantity wiring, add to cart).
  
  Usage (from section):
    {% render 'a24-purchase-bar', product: product, section: section %}
{% endcomment %}

{% liquid
  assign product = product | default: closest.product
  assign section = section | default: nil
  assign current_variant = product.selected_or_first_available_variant
  assign initial_quantity = current_variant.quantity_rule.min | default: 1
  assign initial_quantity = initial_quantity | at_least: 1
  assign initial_quantity = initial_quantity | at_most: 9
  assign form_id = 'A24-ProductForm-'
  if section
    assign form_id = form_id | append: section.id
  else
    assign form_id = form_id | append: product.id
  endif
%}

<div class="a24-product-bar" data-a24-product-bar>
  <form
    method="post"
    action="/cart/add"
    id="{{ form_id }}"
    class="a24-product-bar__form"
    data-product-form
  >
    <input type="hidden" name="id" value="{{ current_variant.id }}">
    
    <div class="a24-product-bar__inner">
      <div class="a24-product-bar__quantity">
        {% render 'a24-selector',
          initial_quantity: initial_quantity,
          input_name: 'quantity',
          section_id: section.id
        %}
      </div>
      
      <div class="a24-product-bar__cta-wrap">
        <button
          type="submit"
          name="add"
          class="a24-product-bar__cta"
          {% unless current_variant.available %}disabled{% endunless %}
          data-add-to-cart-button
        >
          <span class="a24-product-bar__cta-text" data-add-to-cart-text>
            {% if current_variant.available %}
              Add to Cart
            {% else %}
              Sold Out
            {% endif %}
          </span>
        </button>
      </div>
    </div>
  </form>
</div>
